<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="">
		<meta name="author" content="">
		<link rel="icon" type="image/png" href="/assets/favicon.png" />
		<link rel="stylesheet" href="css/doc.css" />
		<title>long term caching</title>
	</head>
	<body>
		<script src="js/doc.js" charset="utf-8" async></script>
		<div class="container">
			<div class="row">
				<div class="col-md-3 nav">

					<div class="logo">
	<ul class="cube-inner">
		<li class="front"><li class="back"><li class="right"><li class="left"><li class="top"><li class="bottom">
	</ul>
	<ul class="cube">
		<li class="front"><li class="back"><li class="right"><li class="left"><li class="top"><li class="bottom">
		<li class="floor">
	</ul>
</div>
<div class="name">webpack</div>
<div class="tagline">MODULE BUNDLER</div>


					<div class="sidebar">
						<ul><li><a href=".">Home</a></li></ul>
						<ul>
<li>入门<ul>
<li><a href="motivation.html">动机</a></li>
<li><a href="what-is-webpack.html">什么是的WebPack？</a></li>
<li><a href="installation.html">安装</a></li>
<li><a href="usage.html">用法</a></li>
<li>Require Modules</li>
<li>Vendor Modules</li>
<li><a href="using-loaders.html">使用加载器</a></li>
<li><a href="using-plugins.html">使用插件</a></li>
<li><a href="dev-tools.html">开发工具</a></li>
<li><a href="troubleshooting.html">故障排除</a></li>
</ul>
</li>
<li>教程与示例<ul>
<li><a href="http://webpack.github.io/docs/tutorials/getting-started/">入门</a></li>
<li><a href="list-of-tutorials.html">教程列表</a></li>
<li><a href="examples.html">示例</a></li>
</ul>
</li>
<li>指南<ul>
<li><a href="commonjs.html">CommonJs</a></li>
<li><a href="amd.html">AMD</a></li>
<li><a href="webpack-for-browserify-users.html">Browserify 用户</a></li>
<li><a href="code-splitting.html">代码分割</a></li>
<li><a href="stylesheets.html">样式表</a></li>
<li><a href="optimization.html">优化</a></li>
<li><a href="long-term-caching.html">长期缓存</a></li>
<li><a href="how-to-write-a-loader.html">如何写一个加载器</a></li>
<li>如何写一个插件(How to write a plugin)</li>
<li><a href="multiple-entry-points.html">多个入口点</a>(Multiple entry points)</li>
<li><a href="library-and-externals.html">库和扩展</a>(Library and externals)</li>
<li><a href="shimming-modules.html">垫片模块</a>(Shimming modules)</li>
<li><a href="testing.html">测试</a></li>
<li><a href="build-performance.html">构建性能</a></li>
<li><a href="hot-module-replacement-with-webpack.html">模块热替换</a>(Hot Module Replacement with webpack)</li>
<li><a href="comparison.html">比较</a></li>
</ul>
</li>
<li>webpack 相关<ul>
<li><a href="usage-with-grunt.html">使用 Grunt</a></li>
<li><a href="usage-with-gulp.html">使用 Gulp</a></li>
<li><a href="usage-with-bower.html">使用 Bower</a></li>
<li><a href="usage-with-karma.html">使用 Karma</a></li>
</ul>
</li>
<li>列表<ul>
<li><a href="loader-conventions.html">加载器约定</a></li>
<li><a href="list-of-loaders.html">加载器列表</a></li>
<li><a href="list-of-plugins.html">插件列表</a></li>
<li><a href="list-of-tutorials.html">教程列表</a></li>
</ul>
</li>
<li>API<ul>
<li><a href="configuration.html">构造</a></li>
<li><a href="cli.html">CLI</a></li>
<li><a href="node.js-api.html">Node.js API</a></li>
<li><a href="api-in-modules.html">API in modules</a></li>
<li><a href="loaders.html">Loaders</a></li>
<li><a href="plugins.html">Plugins</a></li>
<li><a href="context.html">Context</a></li>
<li><a href="resolving.html">Resolving</a></li>
<li><a href="hot-module-replacement.html">Hot Module Replacement</a></li>
<li>开发工具<ul>
<li><a href="webpack-dev-server.html">webpack-dev-server</a></li>
<li><a href="webpack-dev-middleware.html">webpack-dev-middleware</a></li>
</ul>
</li>
</ul>
</li>
<li>Development<ul>
<li><a href="changelog.html">更新日志</a></li>
<li><a href="roadmap.html">路线图</a></li>
<li><a href="ideas.html">思路</a></li>
<li>贡献 (Contributing)</li>
</ul>
</li>
</ul>

					</div>
				</div>

				<div class="col-md-9">

					<div class="pull-right">
						<a href="https://github.com/XUEJS/webpack-docs/wiki/long-term-caching/_edit" id="wikieditlink">Edit</a>
					</div>
					<div class="row">
						<div class="col-md-12 page-header">
							<h1 id="wikititle">long term caching</h1>
						</div>
					</div>

					<div class="row">
						<div id="wiki" class="col-md-12">
							<div class="contents"><ul><li><a href="#option-1-one-hash-for-the-bundle">Option 1: One hash for the bundle</a></li><li><a href="#option-2-one-hash-per-chunk">Option 2: One hash per chunk</a></li><li><a href="#get-filenames-from-stats">Get filenames from stats</a></li></ul></li></ul></div><p>To effectively cache your files, they should have a hash or version in their URL. You can emit or move the output files manually in a folder called <code>v1<span class="number">.3</span></code>. But this has several disadvantages: Extra work for the developer and unchanged files aren’t loaded from cache.</p>
<p>Webpack can add hashes for the files to the filename. Loaders that emit files (worker-loader, file-loader) already do this. For the chunks you have to enable it. There are two levels:</p>
<ol>
<li>Compute a hash of all chunks and add it.</li>
<li>Compute a hash per chunk and add it.</li>
</ol>
<h2 id="option-1-one-hash-for-the-bundle"><a class="anchor" href="#option-1-one-hash-for-the-bundle">&rarr;</a>Option 1: One hash for the bundle</h2>
<p>Option 1 is enabled by adding <code>[hash]</code> to the filename config options:</p>
<p><code>webpack .<span class="regexp">/entry output.[hash].bundle.js</span></code></p>
<pre><code>{
    output: {
        path: path.join(__dirname, <span class="string">"assets"</span>, <span class="string">"[hash]"</span>),
        publicPath: <span class="string">"assets/[hash]/"</span>,
        filename: <span class="string">"output.[hash].bundle.js"</span>,
        chunkFilename: <span class="string">"[id].[hash].bundle.js"</span>
    }
}</code></pre><h2 id="option-2-one-hash-per-chunk"><a class="anchor" href="#option-2-one-hash-per-chunk">&rarr;</a>Option 2: One hash per chunk</h2>
<p>Option 2 is enabled by adding <code>[chunkhash]</code> to the chunk filename config option</p>
<p><code>--output-chunk-file [chunkhash].js</code></p>
<pre><code>output: { chunkFilename: <span class="string">"[chunkhash].bundle.js"</span> }</code></pre><p>Note that you need to reference the entry chunk with its hash in your HTML. You may want to extract the hash or the filename from the stats.</p>
<p>In combination with Hot Code Replacement you must use option 1, but not on the <code>publicPath</code> config option.</p>
<h2 id="get-filenames-from-stats"><a class="anchor" href="#get-filenames-from-stats">&rarr;</a>Get filenames from stats</h2>
<p>You probably want to access the final filename of the asset to embed it into your HTML. This information is available in the webpack stats. If you are using the CLI you can run it with <code>--json</code> to get the stats as JSON to stdout.</p>
<p>You can add a plugin such as <a href="https://www.npmjs.com/package/assets-webpack-plugin">assets-webpack-plugin</a> to your configuration which allows you to access the stats object. Here is an example how to write it into a file:</p>
<pre><code>plugins: [
  <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">this</span>.plugin(<span class="string">"done"</span>, <span class="function"><span class="keyword">function</span><span class="params">(stats)</span> {</span>
      require(<span class="string">"fs"</span>).writeFileSync(
        path.join(__dirname, <span class="string">"..."</span>, <span class="string">"stats.json"</span>),
        JSON.stringify(stats.toJson()));
    });
  }
]</code></pre><p>The stats JSON contains a useful property <code>assetsByChunkName</code> which is a object containing chunk name as key and filename(s) as value.</p>
<blockquote>
<p>Note: It’s an array if you are emitting multiple assets per chunk. I. e. a JavaScript file and a SourceMap. The first one is your JavaScript source.</p>
</blockquote>

						</div>
					</div>

					<div class="row">
						<div class="col-md-12">
							<div id="disqus_thread"></div>
						</div>
					</div>
				</div>

			</div>
		</div>
		<a href="https://github.com/webpack/webpack"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_orange_ff7600.png" alt="Fork me on GitHub"></a>
	</body>
</html>